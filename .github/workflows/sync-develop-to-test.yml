# ===================================================
# Sync Develop to Test Workflow
# ===================================================
# Trigger: develop ë¸Œëœì¹˜ì— ë³€ê²½ ë°œìƒ ì‹œ
# Action: dev-test ë¸Œëœì¹˜ë¡œ ì¦‰ì‹œ ì—­ë™ê¸°í™”
# Purpose: í…ŒìŠ¤íŠ¸ í™˜ê²½ì´ í•­ìƒ ìµœì‹  develop ìƒíƒœë¥¼ ë°˜ì˜í•˜ë„ë¡ ìœ ì§€
# ===================================================

name: Sync Develop to dev-test

on:
  push:
    branches:
      - develop

# ë™ì‹œ ì‹¤í–‰ ë°©ì§€
concurrency:
  group: sync-develop-${{ github.ref }}
  cancel-in-progress: true

jobs:
  sync-to-test:
    name: Sync develop -> dev-test
    runs-on: ubuntu-latest

    permissions:
      contents: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Configure Git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

      - name: Sync to dev-test
        run: |
          echo "ğŸ”„ Starting sync: develop -> dev-test"

          # dev-test ë¸Œëœì¹˜ ì²´í¬ì•„ì›ƒ
          git fetch origin dev-test || echo "dev-test branch not found, will create"

          if git rev-parse --verify origin/dev-test > /dev/null 2>&1; then
            git checkout dev-test
            git reset --hard origin/develop

            echo "ğŸ“¥ Synced dev-test with latest develop changes"
          else
            # dev-test ë¸Œëœì¹˜ê°€ ì—†ìœ¼ë©´ ìƒì„±
            git checkout -b dev-test
            echo "ğŸ†• Created dev-test branch from develop"
          fi

          # ì›ê²©ìœ¼ë¡œ push (forceë¡œ ì™„ì „ ë™ê¸°í™”)
          git push origin dev-test --force

          echo "âœ… Sync completed successfully"

      - name: Sync summary
        run: |
          echo "====================================="
          echo "ğŸ“Š Sync Summary"
          echo "====================================="
          echo "Source: develop"
          echo "Target: dev-test"
          echo "Commit: ${{ github.sha }}"
          echo "Triggered by: ${{ github.actor }}"
          echo "====================================="
